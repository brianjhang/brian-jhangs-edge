#!/bin/bash

# Pre-commit hook: é©—è­‰ frontmatter æ ¼å¼
# è‡ªå‹•æª¢æŸ¥ MDX æ–‡ç« çš„ frontmatter æ˜¯å¦ç¬¦åˆè¦ç¯„

echo "ğŸ” åŸ·è¡Œ frontmatter é©—è­‰..."

# åªæª¢æŸ¥è¢«ä¿®æ”¹çš„ MDX æª”æ¡ˆ
CHANGED_MDX=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(mdx|md)$' | grep 'src/content/')

if [ -z "$CHANGED_MDX" ]; then
  echo "âœ… ç„¡ MDX æª”æ¡ˆè®Šæ›´ï¼Œè·³éé©—è­‰"
  exit 0
fi

echo "æª¢æŸ¥åˆ°ä»¥ä¸‹æª”æ¡ˆè®Šæ›´ï¼š"
echo "$CHANGED_MDX"
echo ""

# åŸ·è¡Œ frontmatter é©—è­‰
npm run validate:frontmatter --silent

RESULT=$?

if [ $RESULT -eq 0 ]; then
  echo "âœ… Frontmatter é©—è­‰é€šé"
  exit 0
else
  echo ""
  echo "âŒ Frontmatter é©—è­‰å¤±æ•—"
  echo ""
  echo "ğŸ’¡ å»ºè­°ï¼š"
  echo "   1. åŸ·è¡Œè‡ªå‹•ä¿®æ­£: npm run fix:frontmatter"
  echo "   2. æ‰‹å‹•ä¿®æ­£å¾Œé‡æ–°æäº¤"
  echo "   3. å¦‚éœ€è·³éé©—è­‰: git commit --no-verify"
  echo ""
  exit 1
fi
