# Gemini CLI 分批執行最佳實踐指南

## 📋 背景問題

Gemini CLI 在處理複雜任務時會出現 `command timed out after 2m 0.0s` 錯誤，特別是：
- 一次性生成多篇長文章（每篇 2500-3000 字）
- 複雜的多步驟處理任務
- 需要大量上下文分析的請求

## ✅ 解決方案：分批執行策略

### 核心原則
> **拆分查詢（Divide and Conquer）**：將一個複雜的大問題拆分成多個簡單、具體的小問題，分次進行查詢。

### 📝 實戰執行流程

#### 原來的錯誤方式（會超時）
```bash
# ❌ 錯誤：一次性生成過多內容
gemini -p "請根據 docs/topics/ 三個主題規劃檔案，為今日 2025-09-04 生成三篇文章。請按照各主題的寫作風格指導和 Brian 風格標準生成內容：

1. AI 小百科：本地部署大模型指南 (Ollama, LM Studio 實戰)
2. 幣圈筆記：財庫策略解析 (MicroStrategy BTC + BitMine ETH)  
3. 創業筆記：CEO 的孤獨與決策 (創業維艱)

每篇文章需要：
- 遵循對應主題的寫作風格和必要框架
- 包含完整的 frontmatter 欄位
- 字數達到品質標準 (2500-3000字)
- 使用繁體中文撰寫
- 符合 Brian 風格寫作手冊標準

請一次生成三篇完整文章內容。"
```

#### 正確的分批方式（成功執行）

**第一步：生成單篇文章大綱**
```bash
# ✅ 正確：先生成大綱
gemini -p "請為 AI 小百科系列生成今日文章大綱：「本地部署大模型指南」。包含：1) 文章標題和描述 2) 主要章節結構 3) 重點技術要點（Ollama, LM Studio）4) 目標讀者和難度定位。請簡潔回答，避免冗長解釋。"
```

**第二步：生成 frontmatter 和開頭**
```bash
# ✅ 正確：分別處理格式和內容
gemini -p "請為「本地部署大模型指南 (Ollama & LM Studio)」這篇 AI 小百科文章生成 frontmatter 和開頭。標題應該是關於本地部署，不是 O1 模型。請嚴格按照主題：本地部署大模型指南。"
```

**第三步：生成主要內容章節**
```bash
# ✅ 正確：分批生成內容章節
gemini -p "請為本地部署大模型文章生成以下章節的內容：1) 硬體需求評估章節 2) Ollama 工具介紹與安裝步驟 3) LM Studio 工具介紹與安裝步驟。每個章節約 400-500 字，包含實用的技術細節和步驟說明。"
```

**第四步：重複流程處理其他文章**
```bash
# ✅ 為每篇文章重複相同的分批流程
gemini -p "請為幣圈筆記系列生成今日文章大綱：「財庫策略解析：MicroStrategy BTC + BitMine ETH」..."
gemini -p "請為創業筆記系列生成今日文章大綱：「CEO 的孤獨與決策：創業維艱」..."
```

### 🎯 分批策略關鍵要素

#### 1. 明確限制回應簡潔性
在 prompt 中加入明確指示：
- `請簡潔回答，避免冗長解釋`
- `請直接提供核心事實，避免冗長解釋以防超時`

#### 2. 單一焦點原則
每次查詢只處理 1-2 個具體問題：
- ✅ 只生成大綱
- ✅ 只生成 frontmatter 
- ✅ 只生成特定章節
- ❌ 不要同時要求大綱+內容+格式

#### 3. 漸進式構建
按照邏輯順序逐步構建：
```
大綱 → frontmatter → 開頭 → 主要章節 → 結尾 → FAQ
```

### 📊 成功案例記錄

**日期**：2025-09-04  
**任務**：生成三篇主題文章  
**結果**：✅ 成功完成，無超時

**執行統計**：
- 總查詢次數：8 次
- 每次查詢時間：< 2 分鐘
- 總完成時間：約 15 分鐘
- 超時次數：0 次

### ⚠️ 注意事項

1. **避免貪心**：不要因為某次查詢成功就增加下次查詢的複雜度
2. **保持一致性**：在同一對話中完成相關查詢，避免跨會話的資訊矛盾
3. **品質檢查**：分批生成後要檢查內容的連貫性和一致性
4. **上下文管理**：確保後續查詢能夠理解前面生成的內容

### 🔄 標準作業程序（SOP）

對於內容生成任務，永遠按照以下順序分批執行：

1. **規劃階段**：生成大綱和結構
2. **格式階段**：生成 frontmatter 和元數據
3. **內容階段**：分章節生成主要內容
4. **完善階段**：生成結尾、FAQ、總結等

### 📝 模板參考

```bash
# 階段 1：大綱生成
gemini -p "請為 [系列名稱] 生成今日文章大綱：「[文章主題]」。包含：1) 標題描述 2) 章節結構 3) 核心要點 4) 目標定位。請簡潔回答。"

# 階段 2：格式生成  
gemini -p "請為「[文章主題]」生成完整的 frontmatter 和開頭段落。需要包含：[具體欄位要求]。請簡潔輸出。"

# 階段 3：內容生成
gemini -p "請為 [文章主題] 生成以下章節：[具體章節名稱]。每章節約 [字數] 字，包含 [具體要求]。"
```

---

**更新記錄**：
- 2025-09-04：首次建立，基於成功解決超時問題的實戰經驗