---
interface Props {
  title?: string;
  category?: string;
}

const { title = '', category = '' } = Astro.props;

// æ ¹æ“šæ–‡ç« é¡åˆ¥è¨­å®šä¸åŒçš„ category æ¨™è­˜
const giscusCategory = category ? `${category}-comments` : 'general';
---

<div class="comments-section">
  <h3 class="comments-title">ğŸ’¬ è¨è«–èˆ‡å›é¥‹</h3>
  <p class="comments-description">æ­¡è¿åœ¨ä¸‹æ–¹ç•™è¨€è¨è«–ï¼Œåˆ†äº«ä½ çš„æƒ³æ³•æˆ–æå‡ºå•é¡Œï¼</p>

  <div id="comments-container">
    <!-- Giscus è©•è«–ç³»çµ±å°‡åœ¨é€™è£¡è¼‰å…¥ -->
  </div>
</div>

<script>
  // å‹•æ…‹è¼‰å…¥ Giscus è©•è«–ç³»çµ±
  function loadGiscus() {
    // æª¢æŸ¥æ˜¯å¦å·²ç¶“è¼‰å…¥é
    if (document.querySelector('#comments-container script')) {
      return;
    }

    // å‰µå»º Giscus script å…ƒç´ 
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', 'brianjhang/brian-jhangs-edge');
    script.setAttribute('data-repo-id', 'R_kgDOPfo3Qg');
    script.setAttribute('data-category', 'Comments');
    script.setAttribute('data-category-id', 'DIC_kwDOPfo3Qs4CvtGO');
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'top');
    script.setAttribute('data-theme', 'preferred_color_scheme');
    script.setAttribute('data-lang', 'zh-TW');
    script.setAttribute('data-loading', 'lazy');
    script.crossOrigin = 'anonymous';
    script.async = true;

    // å°‡ script æ’å…¥å®¹å™¨
    const container = document.getElementById('comments-container');
    if (container) {
      container.appendChild(script);
    }
  }

  // é é¢è¼‰å…¥å¾Œåˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', loadGiscus);

  // æ”¯æ´ Astro çš„å®¢æˆ¶ç«¯è·¯ç”±
  document.addEventListener('astro:page-load', loadGiscus);
</script>

<style>
  .comments-section {
    margin-top: 48px;
    padding-top: 32px;
    border-top: 1px solid var(--border);
  }

  .comments-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--brand);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .comments-description {
    color: var(--muted);
    font-size: 0.9rem;
    margin-bottom: 24px;
    line-height: 1.5;
  }

  #comments-container {
    min-height: 200px;
    position: relative;
  }

  /* Loading ç‹€æ…‹ */
  #comments-container:empty::after {
    content: 'è¼‰å…¥è©•è«–ç³»çµ±ä¸­...';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--muted);
    font-size: 0.9rem;
  }

  /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
  @media (max-width: 768px) {
    .comments-section {
      margin-top: 32px;
      padding-top: 24px;
    }

    .comments-title {
      font-size: 1.25rem;
    }
  }

  /* Giscus æ¨£å¼å®¢è£½åŒ– */
  :global(.giscus) {
    margin-top: 16px;
  }

  :global(.giscus-frame) {
    border-radius: 8px;
    border: 1px solid var(--border);
  }
</style>