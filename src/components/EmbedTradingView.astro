---
const { 
  symbol = "BINANCE:BTCUSDT", 
  interval = "D",
  theme = "dark",
  height = "480px",
  locale = "zh_TW" 
} = Astro.props;

// 為不同交易所調整符號格式
let formattedSymbol = symbol;

// Binance 特殊符號處理
if (symbol === "BINANCE:USDTUSD") {
  formattedSymbol = "BINANCEUS:USDTUSD";
}
if (symbol === "BINANCE:USDCUSD") {
  formattedSymbol = "BINANCEUS:USDCUSD";
}
if (symbol === "BINANCE:MATICUSDT") {
  formattedSymbol = "BINANCE:POLUSDT";
}

// ETF 符號處理 - 確保使用正確的交易所
// 比特幣 ETF
if (symbol === "BLACKROCK:IBIT") {
  formattedSymbol = "NASDAQ:IBIT";
}
if (symbol === "FIDELITY:FBTC") {
  formattedSymbol = "NASDAQ:FBTC";
}
if (symbol === "ARK:ARKB") {
  formattedSymbol = "NASDAQ:ARKB";
}
if (symbol === "BITWISE:BITB") {
  formattedSymbol = "NYSE:BITB";
}

// 以太坊 ETF
if (symbol === "BLACKROCK:ETHA") {
  formattedSymbol = "NASDAQ:ETHA";
}
if (symbol === "FIDELITY:FETH") {
  formattedSymbol = "NASDAQ:FETH";
}
---

<!-- TradingView Widget BEGIN -->
<div class="tradingview-widget-container" style={`height:${height};width:100%;margin:24px 0;`}>
  <div class="tradingview-widget-container__widget" style="height:calc(100% - 32px);width:100%"></div>
  <div class="tradingview-widget-copyright">
    <a href={`https://tw.tradingview.com/symbols/${formattedSymbol.replace(':', '-')}/?exchange=${formattedSymbol.split(':')[0]}`} 
       rel="noopener nofollow" target="_blank">
      <span class="blue-text">Track all markets on TradingView</span>
    </a>
  </div>
  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async set:html={`
  {
    "allow_symbol_change": true,
    "calendar": false,
    "details": false,
    "hide_side_toolbar": true,
    "hide_top_toolbar": false,
    "hide_legend": false,
    "hide_volume": false,
    "hotlist": false,
    "interval": "${interval}",
    "locale": "${locale}",
    "save_image": true,
    "style": "1",
    "symbol": "${formattedSymbol}",
    "theme": "${theme}",
    "timezone": "Etc/UTC",
    "backgroundColor": "#0F0F0F",
    "gridColor": "rgba(242, 242, 242, 0.06)",
    "watchlist": [],
    "withdateranges": false,
    "compareSymbols": [],
    "studies": [],
    "autosize": false,
    "width": "100%",
    "height": 440
  }
  `}></script>
</div>
<!-- TradingView Widget END -->

<style>
  .tradingview-widget-container {
    position: relative;
    box-sizing: border-box;
  }
  
  .tradingview-widget-container__widget {
    position: relative;
    box-sizing: border-box;
  }
  
  .tradingview-widget-copyright {
    font-size: 13px !important;
    line-height: 32px;
    text-align: center;
    vertical-align: middle;
    font-family: -apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif;
    color: #B2B5BE;
  }
  
  .tradingview-widget-copyright .blue-text {
    color: #2196F3;
    text-decoration: none;
  }
  
  .tradingview-widget-copyright a:hover .blue-text {
    text-decoration: underline;
  }
</style>
