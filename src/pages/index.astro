---
import { getCollection } from "astro:content";

const all = await getCollection("daily");
const byDateDesc = (a,b) => new Date(b.data.date) - new Date(a.data.date);
const latest = all.toSorted(byDateDesc);

// Get today's date in YYYY-MM-DD format (Taiwan timezone)
const today = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Taipei' });

// Function to pick today's article first, fallback to latest
const pickToday = (series) => {
  const todayArticle = all.find(p => p.data.series === series && p.data.date === today);
  return todayArticle || latest.find(p => p.data.series === series);
};

const latestCrypto = pickToday("crypto");
const latestAI = pickToday("ai");
const latestFounder = pickToday("founder");

const recent = latest.slice(0, 6);
---
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Brian Jhang's Edge — Startups × AI × Web3</title>
    <meta name="description" content="創業 × AI × Web3 的可執行知識基地" />
    <meta property="og:title" content="Brian Jhang's Edge" />
    <meta property="og:description" content="Startups × AI × Web3 — Actionable Insights for the Next Builders" />
    <meta property="og:type" content="website" />
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7F14DYS5K2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7F14DYS5K2');
    </script>
    <style>
      :root { 
        --bg:#0b0b0c; 
        --muted:#9ca3af; 
        --card:#0f1115; 
        --border:#1f2937; 
        --brand:#fafafa;
        --card-hover:#121218;
        --shadow: 0 4px 12px rgba(0,0,0,0.15);
        --shadow-hover: 0 8px 25px rgba(0,0,0,0.25);
      }
      *{box-sizing:border-box}
      body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto;line-height:1.7;background:#0b0b0c;color:#e5e7eb}
      a{color:inherit;text-decoration:none}
      .wrap{max-width:1200px;margin:0 auto;padding:0 20px}
      header{position:sticky;top:0;background:rgba(11,11,12,.85);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);z-index:20;box-shadow:var(--shadow)}
      .header-content{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;align-items:center;justify-content:space-between;padding-top:16px;padding-bottom:16px}
      .brand{font-weight:800;color:#fff;text-decoration:none;font-size:18px}
      nav{display:flex;gap:20px}
      nav a{color:#cbd5e1;font-weight:500;transition:color 0.2s ease;text-decoration:none}
      nav a:hover{color:#fff}
      .btn{display:inline-block;padding:12px 18px;border-radius:12px;border:1px solid #374151;font-weight:500;transition:all 0.2s ease}
      .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
      .btn.primary{background:#fff;color:#111;border-color:#fff}
      .btn.primary:hover{background:#f0f0f0}
      .hero{padding:90px 0 60px;border-bottom:1px solid var(--border);background:linear-gradient(135deg, #0b0b0c 0%, #111318 50%, #0b0b0c 100%)}
      .hero h1{margin:0 0 12px 0;font-size:48px;font-weight:800;letter-spacing:-0.02em;color:#fff;line-height:1.1}
      .hero p{margin:0;color:#cbd5e1;font-size:18px;line-height:1.6}
      .cta{margin-top:24px;display:flex;gap:16px;flex-wrap:wrap}
      .grid{display:grid;gap:20px}
      @media(min-width:900px){.grid-3{grid-template-columns:repeat(3,1fr)}.grid-2{grid-template-columns:repeat(2,1fr)}}
      .section{padding:40px 0}
      .title{margin:0 0 20px 0;font-size:28px;font-weight:700;color:#fff}
      .card{
        background:var(--card);
        border:1px solid var(--border);
        border-radius:16px;
        padding:20px;
        transition:all 0.3s ease;
        box-shadow:var(--shadow);
        height:100%;
        display:flex;
        flex-direction:column;
      }
      .card:hover{
        background:var(--card-hover);
        border-color:#374151;
        transform:translateY(-2px);
        box-shadow:var(--shadow-hover);
      }
      .card h3{
        margin:8px 0 12px 0;
        color:#fff;
        font-size:18px;
        font-weight:600;
        line-height:1.4;
        flex-grow:1;
      }
      .muted{color:var(--muted);font-size:14px;line-height:1.5}
      .tag{display:inline-flex;align-items:center;gap:6px;font-size:12px;font-weight:500;color:#cbd5e1;background:#111827;border:1px solid #1f2937;border-radius:999px;padding:4px 10px}
      footer{border-top:1px solid var(--border);padding:32px 0;color:#9ca3af;background:rgba(15,17,21,0.5)}
      
      /* Mobile responsiveness */
      @media(max-width:768px){
        .hero{padding:60px 0 40px}
        .hero h1{font-size:36px}
        .hero p{font-size:16px}
        .section{padding:32px 0}
        .title{font-size:24px}
        .grid{gap:16px}
        .card{padding:16px}
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-content">
        <a href="/" class="brand">Brian Jhang's Edge</a>
        <nav>
          <a href="/daily">今日精選</a>
          <a href="/about">關於</a>
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="wrap">
        <h1>Startups × AI × Web3</h1>
        <p>Actionable Insights for the Next Builders ・ 創業 × AI × Web3 的可執行知識基地</p>
        <div class="cta">
          <a class="btn primary" href="#daily">查看今日精選</a>
          <a class="btn" href="/daily">所有文章</a>
        </div>
      </div>
    </section>

    <main class="wrap">
      <section id="daily" class="section">
        <h2 class="title">今日精選</h2>
        <div class="grid grid-3">
          {latestCrypto && (
            <a class="card" href={`/daily/${latestCrypto.slug}`}>
              <div class="muted">{latestCrypto.data.date} · <span class="tag">幣圈筆記</span></div>
              <h3 style="margin:6px 0 8px 0;color:#fff">{latestCrypto.data.title}</h3>
              <p class="muted">{latestCrypto.data.summary}</p>
            </a>
          )}
          {latestAI && (
            <a class="card" href={`/daily/${latestAI.slug}`}>
              <div class="muted">{latestAI.data.date} · <span class="tag">AI 小百科</span></div>
              <h3 style="margin:6px 0 8px 0;color:#fff">{latestAI.data.title}</h3>
              <p class="muted">{latestAI.data.summary}</p>
            </a>
          )}
          {latestFounder && (
            <a class="card" href={`/daily/${latestFounder.slug}`}>
              <div class="muted">{latestFounder.data.date} · <span class="tag">創業筆記</span></div>
              <h3 style="margin:6px 0 8px 0;color:#fff">{latestFounder.data.title}</h3>
              <p class="muted">{latestFounder.data.summary}</p>
            </a>
          )}
          {(!latestCrypto && !latestAI && !latestFounder) && (
            <div class="muted">（尚無內容，請稍後再試）</div>
          )}
        </div>
      </section>

      <section class="section">
        <h2 class="title">最新更新</h2>
        <div class="grid grid-3">
          {recent.map(p => (
            <a class="card" href={`/daily/${p.slug}`}>
              <div class="muted">{p.data.date} · {p.data.series}</div>
              <h3 style="margin:6px 0 8px 0;color:#fff">{p.data.title}</h3>
              <p class="muted">{p.data.summary}</p>
            </a>
          ))}
        </div>
      </section>

      <section class="section">
        <h2 class="title">學習路徑</h2>
        <div class="grid grid-3">
          <div class="card">
            <div class="tag">Web3 入門 → 進階</div>
            <h3 style="margin:8px 0 8px;color:#fff">交易所、鏈上數據、風控框架</h3>
            <p class="muted">從錢包、安全與基礎概念開始，逐步建立你的投資決策系統。</p>
          </div>
          <div class="card">
            <div class="tag">AI 應用與 Vibe Coding</div>
            <h3 style="margin:8px 0 8px;color:#fff">從 0 到 1 做出原型</h3>
            <p class="muted">框架 + 小步快跑，結合 LoRA / RAG / Agent 打出第一版產品。</p>
          </div>
          <div class="card">
            <div class="tag">連續創業框架</div>
            <h3 style="margin:8px 0 8px;color:#fff">從假設 → 驗證 → 上線</h3>
            <p class="muted">市場—產品配適、定價、MVP、迭代節奏與團隊心態。</p>
          </div>
        </div>
      </section>

    </main>

    <footer>
      <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <p class="muted" style="margin:0">© {new Date().getFullYear()} Brian Jhang's Edge ・ 教育用途，非投資建議。</p>
        <div style="display:flex;gap:16px;align-items:center">
          <a href="https://x.com/brianjhang" rel="noopener" target="_blank" class="muted" style="transition:color 0.2s ease" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#9ca3af'">X</a>
          <a href="https://threads.net/@brianjhang" rel="noopener" target="_blank" class="muted" style="transition:color 0.2s ease" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#9ca3af'">Threads</a>
          <a href="https://www.facebook.com/iambrianjhang" rel="noopener" target="_blank" class="muted" style="transition:color 0.2s ease" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#9ca3af'">Facebook</a>
          <a href="https://github.com/brianjhang" rel="noopener" target="_blank" class="muted" style="transition:color 0.2s ease" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#9ca3af'">GitHub</a>
        </div>
      </div>
    </footer>
  </body>
</html>
